# Modified: Mercatorums do not count against subject limits
refresh_subject_count_loyalty_penalty = {
	every_subject = { erase_modifier = { MOD = divided_patronage } }
	if = {
		limit = {
			NOR = {
				has_civic = civic_feudal_realm
				has_civic = civic_franchising
				has_ascension_perk = ap_shared_destiny
			}
			subjects > 1
		}
		set_variable = {
			which = subjects_minus_one
			value = trigger:subjects
		}
		subtract_variable = {
			which = subjects_minus_one
			value = 1
		}
		if = {
			limit = {
				check_variable = {
					which = subjects_minus_one
					value > 0
				}
				any_subject = { is_specialist_subject_type = { TYPE = mercatorum } }
			}
			subtract_variable = {
				which = subjects_minus_one
				value = 1
			}
		}
		every_subject = {
			add_modifier = {
				modifier = divided_patronage
				multiplier = prev.subjects_minus_one
			}
		}
		clear_variable = subjects_minus_one
	}
}